<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Your Service - RawArts Service</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
            font-family: "Open Sans", sans-serif;
        }
        .page-container {
            width: 100%;
            background-color: white;
            min-height: 100vh;
        }
        .header {
            width: 100%;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px;
            margin: 0 auto;
        }
        .logo {
            height: 121px;
            width: 200px;
        }
        .step-navigation {
            width: 100%;
            background-color: #f8f9fa;
            padding: 18px 0;
            border-bottom: 1px solid #ddd;
        }
        .step-nav-content {
            margin: 0 auto;
            padding: 0 18px;
        }
        .steps {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 38px;
            position: relative;
        }
        .step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 14px;
            right: -33px;
            width: 28px;
            height: 1px;
            background-color: #ddd;
            z-index: 1;
        }
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            position: relative;
            z-index: 2;
        }
        .step-number {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
        }
        .step.active .step-number {
            background-color: #ff4444;
            color: white;
        }
        .step.inactive .step-number {
            background-color: #ddd;
            color: #666;
        }
        .step-label {
            font-weight: normal;
            color: #333;
            font-size: 14px;
        }
        .step.inactive .step-label {
            color: #666;
        }
        .main-content {
            display: flex;
            min-height: calc(100vh - 200px);
        }
        .left-panel {
            width: 400px;
            background-color: #f8f9fa;
            padding: 5px 20px 20px 20px;
            border-right: 1px solid #ddd;
        }
        .summary-section {
            margin-bottom: 20px;
        }
        .summary-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }
        .summary-item {
            margin-bottom: 8px;
            padding: 4px 16px;
            background: white;
            border-radius: 4px;
            border: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            transition: border-color 0.3s ease;
            width: 100%;
            max-width: 350px;
        }
        .summary-item:hover {
            border-color: #28a745;
        }
        .summary-content {
            display: flex;
            gap: 8px;
            align-items: baseline;
            flex: 1;
        }
        .summary-label {
            font-weight: 600;
            color: #666;
            font-size: 11px;
            text-transform: uppercase;
            flex-shrink: 0;
        }
        .summary-value {
            color: #333;
            font-size: 13px;
        }
        .edit-icon {
            cursor: pointer;
            color: #666;
            font-size: 14px;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        .edit-icon:hover {
            background-color: #f0f0f0;
            color: #ff4444;
        }
        .right-content {
            flex: 1;
            padding: 40px;
        }
        .content-title {
            font-size: 2rem;
            color: #333;
            margin-bottom: 30px;
            font-weight: 600;
        }
        .form-section {
            margin-bottom: 40px;
        }
        .section-title {
            font-size: 1.3rem;
            color: #333;
            margin-bottom: 20px;
            font-weight: 600;
        }
        .frequency-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
            max-width: 500px;
        }
        .frequency-option {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        .frequency-option:hover {
            border-color: #28a745;
            background-color: #f8fff9;
        }
        .frequency-option.selected {
            border-color: #28a745;
            background-color: #28a745;
            color: white;
        }
        .frequency-option.disabled {
            background-color: #f5f5f5;
            border-color: #e0e0e0;
            color: #999;
            cursor: not-allowed;
            opacity: 0.6;
        }
        .frequency-option.disabled:hover {
            border-color: #e0e0e0;
            background-color: #f5f5f5;
        }
        .frequency-icon {
            font-size: 1.3rem;
            margin-bottom: 6px;
            display: block;
        }
        .frequency-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 3px;
        }
        .frequency-description {
            font-size: 0.75rem;
            opacity: 0.8;
        }
        
        /* Time Selection Styles */
        .time-selection-section {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        .time-selection-section h3 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 1.1rem;
        }
        .time-slots h4 {
            margin: 0 0 15px 0;
            color: #333;
        }
        .slots-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }
        .time-slot {
            padding: 10px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .time-slot:hover {
            border-color: #28a745;
            background: #f8fff9;
        }
        .time-slot.selected {
            border-color: #28a745;
            background: #28a745;
            color: white;
        }
        .time-slot.disabled {
            background: #f5f5f5;
            color: #999;
            cursor: not-allowed;
            border-color: #e0e0e0;
        }
        
        /* Estimation Window Styles */
        .estimation-window {
            margin-top: 15px;
            display: none;
            max-width: 350px;
        }
        .estimation-item {
            margin-bottom: 8px;
            padding: 4px 16px;
            background: #000000;
            border-radius: 4px;
            border: 1px solid #333333;
            width: 100%;
            max-width: 350px;
        }
        .estimation-content {
            display: flex;
            flex-direction: row;
            width: 100%;
        }
        .estimation-half {
            flex: 1;
            text-align: center;
            padding: 8px 4px;
        }
        .estimation-half:first-child {
            border-right: 1px solid #555555;
        }
        .estimation-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: white;
        }
        .estimation-separator {
            width: 80%;
            height: 1px;
            background-color: #666666;
            margin: 5px auto;
        }
        .estimation-label {
            font-size: 8px;
            color: #cccccc;
            text-transform: uppercase;
            font-weight: 600;
        }
        .estimation-note {
            margin-top: 5px;
            text-align: center;
            font-size: 0.7rem;
            color: #cccccc;
            font-style: italic;
            line-height: 1.2;
        }
        
        /* Detailed Booking Form Styles */
        .detailed-booking-section {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #ddd;
            display: none;
            max-width: 500px;
        }
        .booking-header {
            margin-bottom: 20px;
        }
        .booking-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        .booking-subtitle {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 15px;
        }
        .form-group {
            margin-bottom: 25px;
        }
        .form-label {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            display: block;
        }
        .home-size-options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
            max-width: 400px;
        }
        .home-size-dropdown {
            width: 100%;
            max-width: 500px;
            padding: 12px 16px;
            border: 2px solid #28a745;
            border-radius: 25px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .home-size-dropdown:focus {
            border-color: #218838;
            outline: none;
        }
        .home-size-option {
            border: 2px solid #ddd;
            border-radius: 6px;
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        .home-size-option:hover {
            border-color: #28a745;
            background-color: #f8fff9;
        }
        .home-size-option.selected {
            border-color: #28a745;
            background-color: #28a745;
            color: white;
        }
        .extra-tasks {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 8px;
            max-width: 600px;
        }
        .extra-task {
            border: 2px solid #28a745;
            border-radius: 25px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            text-align: center;
            font-size: 0.9rem;
        }
        .extra-task:hover {
            border-color: #218838;
            background-color: #f8fff9;
        }
        .extra-task.selected {
            border-color: #28a745;
            background-color: #28a745;
            color: white;
        }
        .time-input-group {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: nowrap;
        }
        .time-input-group .form-label {
            margin-bottom: 0;
            margin-right: 10px;
            white-space: nowrap;
        }
        .hour-selector {
            display: flex;
            align-items: center;
            gap: 15px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 30px;
            padding: 10px 20px;
            flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .hour-btn {
            background: white;
            color: #28a745;
            border: 2px solid #28a745;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .hour-btn:hover {
            background: #f8fff9;
            border-color: #218838;
            color: #218838;
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .hour-btn:active {
            transform: scale(0.95);
        }
        .hour-btn.disabled {
            background: #f5f5f5;
            color: #ccc;
            border-color: #ddd;
            cursor: not-allowed;
            opacity: 0.6;
        }
        .hour-btn.disabled:hover {
            background: #f5f5f5;
            color: #ccc;
            border-color: #ddd;
            transform: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .hour-display {
            font-size: 1.5rem;
            font-weight: 700;
            min-width: 60px;
            text-align: center;
            color: #333;
            margin: 0 5px;
        }
        .time-input {
            width: 100%;
            max-width: 500px;
            padding: 12px 16px;
            border: 2px solid #28a745;
            border-radius: 25px;
            font-size: 1rem;
            background: white;
            transition: all 0.3s ease;
        }
        .time-input:focus {
            border-color: #218838;
            outline: none;
        }
        .time-dropdown {
            width: auto;
            max-width: 300px;
            padding: 12px 16px;
            border: 2px solid #28a745;
            border-radius: 25px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .time-dropdown:focus {
            border-color: #218838;
            outline: none;
        }
        .date-selector {
            width: auto;
            max-width: 300px;
            padding: 12px 16px;
            border: 2px solid #28a745;
            border-radius: 25px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .date-selector:hover {
            border-color: #218838;
            background-color: #f8fff9;
        }
        .date-arrow {
            color: #28a745;
            font-size: 0.8rem;
        }
        .hidden-date-input {
            position: absolute;
            opacity: 0;
            pointer-events: none;
            z-index: -1;
        }
        .time-display {
            padding: 8px 12px;
            background: #28a745;
            color: white;
            border-radius: 6px;
            font-weight: 600;
        }
        .instructions-textarea {
            width: 100%;
            max-width: 500px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            font-family: "Times New Roman", Times, serif;
            resize: vertical;
            min-height: 80px;
            background-color: #f9f9f9;
            color: #333;
        }
        .instructions-textarea::placeholder {
            color: #999;
            font-style: italic;
        }
        .instructions-textarea:focus {
            border-color: #28a745;
            outline: none;
        }
        .form-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: flex-start;
        }
        .back-btn {
            padding: 12px 24px;
            border: 2px solid #ddd;
            border-radius: 25px;
            background: white;
            color: #666;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .back-btn:hover {
            border-color: #999;
            color: #333;
        }
        .find-provider-btn {
            padding: 12px 24px;
            border: 2px solid #28a745;
            border-radius: 25px;
            background: #28a745;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .find-provider-btn:hover {
            background: #218838;
            border-color: #218838;
        }
        
        /* Loading Overlay Styles */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 9999;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .loading-logo {
            width: 200px;
            height: auto;
            margin-bottom: 40px;
        }
        .loading-text {
            font-size: 1.2rem;
            color: #333;
            margin-bottom: 30px;
            font-weight: 600;
        }
        .progress-container {
            width: 300px;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        .progress-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        .progress-percentage {
            font-size: 0.9rem;
            color: #666;
            font-weight: 600;
        }
    </style>
</head><bod
y>
    <div class="page-container">
        <header class="header">
            <div class="header-content">
                <a href="index.html"><img src="RawArtsLogo.png" alt="RawArts" class="logo"></a>
            </div>
        </header>

        <div class="step-navigation">
            <div class="step-nav-content">
                <div class="steps">
                    <div class="step active">
                        <div class="step-number">1</div>
                        <div class="step-label">Details</div>
                    </div>
                    <div class="step inactive">
                        <div class="step-number">2</div>
                        <div class="step-label">Worker</div>
                    </div>
                    <div class="step inactive">
                        <div class="step-number">3</div>
                        <div class="step-label">Payment</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="left-panel">
                <div class="summary-title">Booking Details</div>
                
                <div class="summary-item">
                    <div class="summary-content">
                        <div class="summary-label">Where:</div>
                        <div class="summary-value" id="location-address">Loading...</div>
                    </div>
                    <div class="edit-icon" onclick="editLocation()" title="Edit location">‚úèÔ∏è</div>
                </div>
                
                <div class="summary-item" id="unit-summary" style="display: none;">
                    <div class="summary-content">
                        <div class="summary-label">Unit/Apartment:</div>
                        <div class="summary-value" id="location-unit"></div>
                    </div>
                    <div class="edit-icon" onclick="editLocation()" title="Edit location">‚úèÔ∏è</div>
                </div>
                
                <div class="summary-item" id="details-summary" style="display: none;">
                    <div class="summary-content">
                        <div class="summary-label">Additional Details:</div>
                        <div class="summary-value" id="location-details"></div>
                    </div>
                    <div class="edit-icon" onclick="editLocation()" title="Edit location">‚úèÔ∏è</div>
                </div>

                <div class="summary-item">
                    <div class="summary-content">
                        <div class="summary-label">What:</div>
                        <div class="summary-value" id="selected-service">Loading...</div>
                    </div>
                    <div class="edit-icon" onclick="editService()" title="Edit service">‚úèÔ∏è</div>
                </div>
                
                <!-- Estimation Window in Left Panel -->
                <div class="estimation-window" id="estimationWindow">
                    <div class="estimation-item">
                        <div class="estimation-content">
                            <div class="estimation-half">
                                <div class="estimation-value">5.5</div>
                                <div class="estimation-label">Est. Hours</div>
                            </div>
                            <div class="estimation-half">
                                <div class="estimation-value">R355</div>
                                <div class="estimation-label">Est. Price</div>
                            </div>
                        </div>
                    </div>
                    <div class="estimation-note">
                        *Final price may vary based on actual time and service requirements
                    </div>
                </div>
            </div>

            <div class="right-content">
                <h1 class="content-title">How often do you need help?</h1>
                
                <div class="form-section">
                    <h3 class="section-title">How often do you need the service?</h3>
                    
                    <div class="frequency-options">
                        <div class="frequency-option" data-frequency="once-off" onclick="selectFrequency('once-off')">
                            <span class="frequency-icon">üìÖ</span>
                            <div class="frequency-title">Once Off</div>
                            <div class="frequency-description">One-time service for your immediate needs</div>
                        </div>
                        
                        <div class="frequency-option" data-frequency="repeat" onclick="selectFrequency('repeat')">
                            <span class="frequency-icon">üîÑ</span>
                            <div class="frequency-title">Repeat</div>
                            <div class="frequency-description">Regular repeat service every few days / weeks</div>
                        </div>
                    </div>

                    <!-- Time Selection Section -->
                    <div class="time-selection-section" id="timeSelectionSection" style="display: none;">
                        <h3>When do you need help?</h3>
                        
                        <div class="frequency-options">
                            <div class="frequency-option" data-time="tomorrow" onclick="selectTimeOption('tomorrow')">
                                <span class="frequency-icon">üìÖ</span>
                                <div class="frequency-title">Tomorrow / Later</div>
                                <div class="frequency-description">Schedule for tomorrow or any future date</div>
                            </div>
                            
                            <div class="frequency-option" id="todayOption" data-time="today" onclick="selectTimeOption('today')">
                                <span class="frequency-icon">‚è∞</span>
                                <div class="frequency-title">Today</div>
                                <div class="frequency-description">Same day service (5 hour advance notice)</div>
                            </div>
                        </div>

                        <!-- Time Slots for Today -->
                        <div class="time-slots" id="timeSlots" style="display: none;">
                            <h4>Available Time Slots</h4>
                            <div class="slots-grid" id="slotsGrid">
                                <!-- Time slots will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Booking Form -->
                    <div class="detailed-booking-section" id="detailedBookingSection">
                        <div class="booking-header">
                            <h2 class="booking-title">One Time Booking</h2>
                            <p class="booking-subtitle">Get once-off help. Try a new worker. Cancel any time</p>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Add details about your booking</label>
                        </div>

                        <div class="form-group">
                            <label class="form-label">How big is your home?</label>
                            <select class="home-size-dropdown" id="homeSizeSelect" onchange="updateEstimation()">
                                <option value="small">Small Home: 1-2 Bedrooms</option>
                                <option value="medium" selected>Medium Home: 3-4 Bedrooms</option>
                                <option value="large">Large Home: 5+ Bedrooms</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Extra Tasks</label>
                            <div class="extra-tasks">
                                <div class="extra-task" onclick="toggleExtraTask(this)">Inside Fridge</div>
                                <div class="extra-task" onclick="toggleExtraTask(this)">Inside Oven</div>
                                <div class="extra-task" onclick="toggleExtraTask(this)">Inside Cabinets</div>
                                <div class="extra-task" onclick="toggleExtraTask(this)">Interior Windows</div>
                                <div class="extra-task" onclick="toggleExtraTask(this)">Interior Walls</div>
                                <div class="extra-task" onclick="toggleExtraTask(this)">Water Plants</div>
                                <div class="extra-task" onclick="toggleExtraTask(this)">Ironing</div>
                                <div class="extra-task" onclick="toggleExtraTask(this)">Laundry</div>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="time-input-group">
                                <label class="form-label">How Long?</label>
                                <div class="hour-selector">
                                    <button type="button" class="hour-btn" onclick="adjustHours(-0.5)">-</button>
                                    <div class="hour-display" id="hoursDisplay">5.5</div>
                                    <button type="button" class="hour-btn" onclick="adjustHours(0.5)">+</button>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Select start date:</label>
                            <div class="date-selector" onclick="openDatePicker()">
                                <span id="dateDisplay">Mon 13 January</span>
                                <span class="date-arrow">‚ñº</span>
                            </div>
                            <input type="date" class="hidden-date-input" id="startDate" onchange="updateDateDisplay()">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Select start time:</label>
                            <select class="time-dropdown" id="startTimeSelect">
                                <option value="07:00">07:00 - 07:30</option>
                                <option value="07:30">07:30 - 08:00</option>
                                <option value="08:00">08:00 - 08:30</option>
                                <option value="08:30">08:30 - 09:00</option>
                                <option value="09:00">09:00 - 09:30</option>
                                <option value="09:30">09:30 - 10:00</option>
                                <option value="10:00">10:00 - 10:30</option>
                                <option value="10:30">10:30 - 11:00</option>
                                <option value="11:00">11:00 - 11:30</option>
                                <option value="11:30">11:30 - 12:00</option>
                                <option value="12:00">12:00 - 12:30</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Add specific instructions</label>
                            <textarea class="instructions-textarea" placeholder="Add additional notes here..."></textarea>
                        </div>

                        <div class="form-buttons">
                            <button type="button" class="back-btn" onclick="goBack()">Back</button>
                            <button type="button" class="find-provider-btn" onclick="findServiceProvider()">Find Service Provider</button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <img src="RawArtsLogo.png" alt="RawArts" class="loading-logo">
        <div class="loading-text">Finding Service Providers...</div>
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="progress-percentage" id="progressPercentage">0%</div>
    </div>

    <script>
        let selectedFrequency = null;
        let selectedTimeOption = null;
        let selectedTimeSlot = null;

        // Load location data from previous page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== BOOKING DETAILS PAGE LOADED ===');
            
            // Load location and service data from sessionStorage
            const locationData = sessionStorage.getItem('locationData');
            if (locationData) {
                try {
                    const data = JSON.parse(locationData);
                    console.log('Location data loaded:', data);
                    
                    // Set address
                    document.getElementById('location-address').textContent = data.streetAddress || 'No address provided';
                    
                    // Set unit/apartment if provided
                    if (data.unitNumber && data.unitNumber.trim() !== '') {
                        document.getElementById('location-unit').textContent = data.unitNumber;
                        document.getElementById('unit-summary').style.display = 'block';
                    }
                    
                    // Set selected service
                    if (data.service) {
                        document.getElementById('selected-service').textContent = data.service;
                        console.log('Service loaded:', data.service);
                    }
                } catch (e) {
                    console.error('Error parsing location data:', e);
                    document.getElementById('location-address').textContent = 'Error loading address';
                }
            } else {
                console.log('No location data found in sessionStorage');
                document.getElementById('location-address').textContent = 'No address provided';
                document.getElementById('selected-service').textContent = 'No service selected';
            }
        });

        // Select frequency option
        function selectFrequency(frequency) {
            // Remove previous selection
            document.querySelectorAll('.frequency-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Add selection to clicked option
            document.querySelector(`[data-frequency="${frequency}"]`).classList.add('selected');
            
            selectedFrequency = frequency;
            
            // Show time selection section with smooth animation
            const timeSection = document.getElementById('timeSelectionSection');
            timeSection.style.display = 'block';
            timeSection.style.opacity = '0';
            timeSection.style.transform = 'translateY(20px)';
            
            // Animate in
            setTimeout(() => {
                timeSection.style.transition = 'all 0.3s ease';
                timeSection.style.opacity = '1';
                timeSection.style.transform = 'translateY(0)';
            }, 50);
            
            // Scroll to time selection smoothly
            setTimeout(() => {
                timeSection.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }, 100);
            
            // Check if today bookings are available
            checkTodayAvailability();
        }

        // Check if today bookings are available (must be before 12:00 PM and allow 5 hours)
        function checkTodayAvailability() {
            const now = new Date();
            const currentHour = now.getHours();
            const todayOption = document.getElementById('todayOption');
            
            // Always show the today option, but disable it if it's after 12:00 PM
            if (currentHour >= 12) {
                todayOption.classList.add('disabled');
                todayOption.onclick = null; // Remove click handler
                // Update description to show it's fully booked
                const description = todayOption.querySelector('.frequency-description');
                description.textContent = 'Fully Booked';
            } else {
                todayOption.classList.remove('disabled');
                todayOption.onclick = () => selectTimeOption('today'); // Restore click handler
                // Restore original description
                const description = todayOption.querySelector('.frequency-description');
                description.textContent = 'Same day service (5 hour advance notice)';
            }
        }

        // Select time option (today or tomorrow)
        function selectTimeOption(option) {
            // Remove previous selections
            document.querySelectorAll('[data-time]').forEach(opt => opt.classList.remove('selected'));
            
            selectedTimeOption = option;
            
            if (option === 'today') {
                document.querySelector('[data-time="today"]').classList.add('selected');
                generateTodayTimeSlots();
                document.getElementById('timeSlots').style.display = 'block';
                document.getElementById('estimationWindow').style.display = 'none';
            } else if (option === 'tomorrow') {
                document.querySelector('[data-time="tomorrow"]').classList.add('selected');
                document.getElementById('timeSlots').style.display = 'none';
                selectedTimeSlot = 'tomorrow';
                showEstimationWindow();
            }
        }
        
        // Show estimation window with animation
        function showEstimationWindow() {
            const estimationWindow = document.getElementById('estimationWindow');
            estimationWindow.style.display = 'block';
            estimationWindow.style.opacity = '0';
            estimationWindow.style.transform = 'translateY(20px)';
            
            // Hide previous selections immediately
            document.getElementById('timeSelectionSection').style.display = 'none';
            
            // Hide the main title "How often do you need help?"
            const mainTitle = document.querySelector('.content-title');
            if (mainTitle) {
                mainTitle.style.display = 'none';
            }
            
            // Hide the frequency selection section (the "How often do you need help?" section)
            const frequencySection = document.querySelector('.form-section h3');
            const frequencyOptions = document.querySelector('.frequency-options');
            if (frequencySection && frequencySection.textContent.includes('How often')) {
                frequencySection.style.display = 'none';
                frequencyOptions.style.display = 'none';
            }
            
            // Show detailed booking form at the same time as estimation
            showDetailedBookingForm();
            
            setTimeout(() => {
                estimationWindow.style.transition = 'all 0.4s ease';
                estimationWindow.style.opacity = '1';
                estimationWindow.style.transform = 'translateY(0)';
            }, 100);
        }
        
        // Show detailed booking form
        function showDetailedBookingForm() {
            const detailedSection = document.getElementById('detailedBookingSection');
            detailedSection.style.display = 'block';
            detailedSection.style.opacity = '0';
            detailedSection.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                detailedSection.style.transition = 'all 0.4s ease';
                detailedSection.style.opacity = '1';
                detailedSection.style.transform = 'translateY(0)';
            }, 100);
            
            // Set default date to tomorrow
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const dateString = tomorrow.toISOString().split('T')[0];
            document.getElementById('startDate').value = dateString;
            
            // Update the display with tomorrow's date
            updateDateDisplay();
            
            // Initialize hour button states
            setTimeout(() => {
                const currentHours = parseFloat(document.getElementById('hoursDisplay').textContent);
                updateHourButtonStates(currentHours);
            }, 200);
            
            // Add event listener for home size dropdown
            const homeSizeSelect = document.getElementById('homeSizeSelect');
            if (homeSizeSelect) {
                homeSizeSelect.addEventListener('change', function() {
                    updateEstimation(this.value);
                });
            }
        }
        
        // Open date picker
        function openDatePicker() {
            document.getElementById('startDate').showPicker();
        }
        
        // Update date display with formatted date
        function updateDateDisplay() {
            const dateInput = document.getElementById('startDate');
            const dateDisplay = document.getElementById('dateDisplay');
            
            if (dateInput.value) {
                const selectedDate = new Date(dateInput.value + 'T00:00:00');
                const options = { 
                    weekday: 'short', 
                    day: 'numeric', 
                    month: 'long' 
                };
                const formattedDate = selectedDate.toLocaleDateString('en-GB', options);
                dateDisplay.textContent = formattedDate;
            }
        }
        
        // Select home size
        function selectHomeSize(size) {
            document.querySelectorAll('.home-size-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.classList.add('selected');
            updateEstimation(size);
        }
        
        // Update estimation based on home size
        function updateEstimation(homeSize) {
            // Just call the comprehensive update function
            updateEstimationWithExtras();
        }
        
        // Toggle extra task
        function toggleExtraTask(element) {
            element.classList.toggle('selected');
            updateEstimationWithExtras();
        }
        
        // Update estimation including extra tasks
        function updateEstimationWithExtras() {
            const homeSizeSelect = document.getElementById('homeSizeSelect');
            const selectedSize = homeSizeSelect ? homeSizeSelect.value : 'medium';
            
            // Base hours and prices
            let baseHours, basePrice;
            switch(selectedSize) {
                case 'small':
                    baseHours = 4;
                    basePrice = 330;
                    break;
                case 'medium':
                    baseHours = 5.5;
                    basePrice = 375;
                    break;
                case 'large':
                    baseHours = 8;
                    basePrice = 485;
                    break;
                default:
                    baseHours = 5.5;
                    basePrice = 375;
            }
            
            // Count selected extra tasks
            const selectedTasks = document.querySelectorAll('.extra-task.selected');
            const extraTaskCount = selectedTasks.length;
            
            // Calculate new totals (R30 and 1 hour per extra task)
            const totalHours = baseHours + (extraTaskCount * 1);
            const totalPrice = basePrice + (extraTaskCount * 30);
            
            // Update estimation window values
            const hoursValue = document.querySelector('.estimation-half:first-child .estimation-value');
            const priceValue = document.querySelector('.estimation-half:last-child .estimation-value');
            const hoursDisplay = document.getElementById('hoursDisplay');
            
            if (hoursValue) hoursValue.textContent = totalHours.toString();
            if (priceValue) priceValue.textContent = 'R' + totalPrice;
            if (hoursDisplay) hoursDisplay.textContent = totalHours.toString();
        }
        
        // Adjust hours with + and - buttons
        function adjustHours(change) {
            const hoursDisplay = document.getElementById('hoursDisplay');
            let currentHours = parseFloat(hoursDisplay.textContent);
            let newHours = currentHours + change;
            
            // Set minimum and maximum hours (3.5 to 10)
            if (newHours < 3.5) newHours = 3.5;
            if (newHours > 10) newHours = 10;
            
            hoursDisplay.textContent = newHours.toString();
            
            // Update button states
            updateHourButtonStates(newHours);
            
            // Update estimation in left panel
            const hoursValue = document.querySelector('.estimation-half:first-child .estimation-value');
            if (hoursValue) hoursValue.textContent = newHours.toString();
            
            // Calculate new price based on hours (assuming R68 per hour base rate)
            const newPrice = Math.round(newHours * 68);
            const priceValue = document.querySelector('.estimation-half:last-child .estimation-value');
            if (priceValue) priceValue.textContent = 'R' + newPrice;
        }
        
        // Update hour button states based on current value
        function updateHourButtonStates(currentHours) {
            const buttons = document.querySelectorAll('.hour-btn');
            let minusBtn = null;
            let plusBtn = null;
            
            // Find the correct buttons by their onclick content
            buttons.forEach(btn => {
                if (btn.onclick && btn.onclick.toString().includes('-0.5')) {
                    minusBtn = btn;
                } else if (btn.onclick && btn.onclick.toString().includes('0.5') && !btn.onclick.toString().includes('-0.5')) {
                    plusBtn = btn;
                }
            });
            
            // Update minus button (should be disabled at 3.5)
            if (minusBtn) {
                if (currentHours <= 3.5) {
                    minusBtn.classList.add('disabled');
                    minusBtn.style.cursor = 'not-allowed';
                } else {
                    minusBtn.classList.remove('disabled');
                    minusBtn.style.cursor = 'pointer';
                }
            }
            
            // Update plus button (should be disabled at 10)
            if (plusBtn) {
                if (currentHours >= 10) {
                    plusBtn.classList.add('disabled');
                    plusBtn.style.cursor = 'not-allowed';
                } else {
                    plusBtn.classList.remove('disabled');
                    plusBtn.style.cursor = 'pointer';
                }
            }
        }

        // Generate available time slots for today
        function generateTodayTimeSlots() {
            const now = new Date();
            const currentHour = now.getHours();
            const slotsGrid = document.getElementById('slotsGrid');
            slotsGrid.innerHTML = '';
            
            // Generate slots from 7:00 AM to 12:00 PM (with 5-hour minimum notice)
            const minStartHour = Math.max(7, currentHour + 5);
            
            for (let hour = minStartHour; hour <= 12; hour++) {
                // Create 30-minute slots
                for (let minutes of [0, 30]) {
                    if (hour === 12 && minutes === 30) break; // Don't go past 12:00
                    
                    const timeString = `${hour.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
                    const endHour = minutes === 30 ? hour + 1 : hour;
                    const endMinutes = minutes === 30 ? 0 : 30;
                    const endTimeString = `${endHour.toString().padStart(2, '0')}:${endMinutes.toString().padStart(2, '0')}`;
                    
                    const slot = document.createElement('div');
                    slot.className = 'time-slot';
                    slot.textContent = `${timeString} - ${endTimeString}`;
                    slot.onclick = () => selectTimeSlot(timeString, endTimeString);
                    
                    slotsGrid.appendChild(slot);
                }
            }
            
            // If no slots available, show message
            if (slotsGrid.children.length === 0) {
                slotsGrid.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">No time slots available for today. Please select Tomorrow/Later.</div>';
            }
        }

        // Select specific time slot
        function selectTimeSlot(startTime, endTime) {
            // Remove previous selections
            document.querySelectorAll('.time-slot').forEach(slot => slot.classList.remove('selected'));
            
            // Select current slot
            event.target.classList.add('selected');
            
            selectedTimeSlot = { startTime, endTime };
            
            // Enable continue button
            updateContinueButton();
        }

        // Show continue button
        function showContinueButton() {
            const continueBtn = document.getElementById('continueBtn');
            continueBtn.style.display = 'inline-block';
            continueBtn.style.opacity = '0';
            continueBtn.style.transform = 'translateY(10px)';
            
            setTimeout(() => {
                continueBtn.style.transition = 'all 0.3s ease';
                continueBtn.style.opacity = '1';
                continueBtn.style.transform = 'translateY(0)';
            }, 100);
        }

        // Update continue button state
        function updateContinueButton() {
            const continueBtn = document.getElementById('continueBtn');
            
            if (selectedFrequency && selectedTimeOption) {
                if (selectedTimeOption === 'tomorrow' || selectedTimeSlot) {
                    continueBtn.disabled = false;
                    continueBtn.style.background = 'linear-gradient(135deg, #ff4444 0%, #ff6666 100%)';
                } else {
                    continueBtn.disabled = true;
                    continueBtn.style.background = '#ccc';
                }
            }
        }

        // Proceed to next step
        function proceedToNext() {
            if (selectedTimeOption === 'tomorrow') {
                proceedToWorkerSelection('tomorrow');
            } else if (selectedTimeSlot && selectedTimeSlot.startTime) {
                proceedToWorkerSelection('today', selectedTimeSlot.startTime, selectedTimeSlot.endTime);
            }
        }

        // Proceed to worker selection
        function proceedToWorkerSelection(timeOption, startTime = null, endTime = null) {
            if (!selectedFrequency) return;
            
            // Store booking data
            const bookingData = {
                service: document.getElementById('selected-service').textContent,
                location: document.getElementById('location-address').textContent,
                frequency: selectedFrequency,
                timeOption: timeOption,
                startTime: startTime,
                endTime: endTime,
                timestamp: new Date().toISOString()
            };
            
            sessionStorage.setItem('bookingData', JSON.stringify(bookingData));
            
            // Show loading state
            const continueBtn = document.getElementById('continueBtn');
            continueBtn.textContent = 'Processing...';
            continueBtn.disabled = true;
            
            // Navigate to worker selection (placeholder for now)
            console.log('Proceeding to worker selection with:', bookingData);
            
            // For now, show confirmation and redirect
            setTimeout(() => {
                alert(`Booking details confirmed!\n\nService: ${bookingData.service}\nFrequency: ${bookingData.frequency}\nTime: ${timeOption === 'today' ? `Today ${startTime}-${endTime}` : 'Tomorrow/Later'}\n\nProceeding to worker selection...`);
                
                // In a real app, you would navigate to the worker selection page
                // window.location.href = 'worker-selection.html';
                
                // For demo, reset the button
                continueBtn.textContent = 'Continue to Worker Selection';
                continueBtn.disabled = false;
            }, 1000);
        }

        // Edit functions for the summary panel
        function editLocation() {
            window.location.href = 'location-booking.html';
        }

        function editService() {
            window.location.href = 'services.html';
        }

        function editFrequency() {
            // Stay on current page and scroll to frequency selection
            document.querySelector('.frequency-options').scrollIntoView({
                behavior: 'smooth'
            });
        }
        
        // Go back to previous page
        function goBack() {
            window.history.back();
        }
        
        // Find service provider
        function findServiceProvider() {
            // Collect all booking data
            const bookingData = {
                location: document.getElementById('location-address').textContent,
                service: document.getElementById('selected-service').textContent,
                homeSize: document.getElementById('homeSizeSelect').value,
                hours: document.getElementById('hoursDisplay').textContent,
                startDate: document.getElementById('startDate').value,
                startTime: document.getElementById('startTimeSelect').value,
                instructions: document.querySelector('.instructions-textarea').value,
                extraTasks: Array.from(document.querySelectorAll('.extra-task.selected')).map(task => task.textContent),
                timestamp: new Date().toISOString()
            };
            
            // Store booking data
            sessionStorage.setItem('completeBookingData', JSON.stringify(bookingData));
            
            // Update step navigation to show step 2 as active
            updateStepNavigation(2);
            
            // Show loading state on button
            const btn = event.target;
            btn.textContent = 'Finding Providers...';
            btn.disabled = true;
            
            // Show loading overlay
            showLoadingOverlay();
        }
        
        // Show loading overlay with progress animation
        function showLoadingOverlay() {
            const overlay = document.getElementById('loadingOverlay');
            const progressBar = document.getElementById('progressBar');
            const progressPercentage = document.getElementById('progressPercentage');
            
            // Show overlay
            overlay.style.display = 'flex';
            
            // Animate progress from 0 to 100%
            let progress = 0;
            const interval = setInterval(() => {
                progress += 2; // Increase by 2% each step
                
                progressBar.style.width = progress + '%';
                progressPercentage.textContent = progress + '%';
                
                if (progress >= 100) {
                    clearInterval(interval);
                    
                    // Wait a moment at 100% then redirect
                    setTimeout(() => {
                        window.location.href = 'service-provider-database.html';
                    }, 500);
                }
            }, 60); // Update every 60ms (3 seconds total)
        }
        
        // Update step navigation
        function updateStepNavigation(activeStep) {
            // Remove active class from all steps
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
                step.classList.add('inactive');
            });
            
            // Add active class to current step
            const steps = document.querySelectorAll('.step');
            if (steps[activeStep - 1]) {
                steps[activeStep - 1].classList.remove('inactive');
                steps[activeStep - 1].classList.add('active');
            }
        }
    </script>
</body>
</html>